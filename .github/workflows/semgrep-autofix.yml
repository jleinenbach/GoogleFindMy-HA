name: Semgrep Autofix (PR)

on:
  workflow_dispatch:
  schedule:
    - cron: '42 3 * * *'

permissions:
  contents: write
  pull-requests: write

jobs:
  semgrep-autofix:
    name: Run Semgrep autofix
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Install Semgrep
        run: pipx install semgrep

      - name: Run Semgrep autofix
        run: semgrep scan --config auto --metrics=off --autofix || true

      - name: Create pull request
        uses: peter-evans/create-pull-request@v7
        with:
          branch: chore/semgrep-autofix
          commit-message: 'chore: apply Semgrep autofixes'
          title: 'chore: Apply Semgrep autofixes'
          body: |
            ## Summary
            - Apply automated fixes generated by Semgrep autofix workflow.

            ## Details
            - Run `semgrep scan --config auto --metrics=off --autofix` via GitHub Actions.
            - Changes are committed automatically when fixes are detected.
